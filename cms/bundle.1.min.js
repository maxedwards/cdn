(t=>{const e='<path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 18a3.5 3.5 0 0 0 0 -7h-1a5 4.5 0 0 0 -11 -2a4.6 4.4 0 0 0 -2.1 8.4"></path><line x1="12" y1="13" x2="12" y2="22"></line><polyline points="9 19 12 22 15 19"></polyline>',n=t=>{return(e=`https://cdn.jsdelivr.net/gh/maxedwards/cdn/Icons/${t.getAttribute("i")}.htm?`,Promise.race([fetch(e),new Promise((t,e)=>setTimeout(t=>e(new Error("timeout")),5e3))])).then(t=>{if(200==t.status)return t.text();throw 0}).then(e=>t.innerHTML=e).catch(e=>{t.fail=1,delete t.bus});var e},o="undefined"==typeof IntersectionObserver?{observe:n}:new IntersectionObserver((t,o)=>t.forEach(t=>{const s=t.target;s.getAttribute("i");s.bus||(s.bus=1,s.fail&&(s.innerHTML=e,delete s.fail),n(s).then(t=>s.fail?"":o.unobserve(s)))}),{threshold:.5}),s=t=>{let n=t.getAttribute("i"),s=t.getAttribute("h");t.innerHTML=`<svg i="${n}" xmlns="http://www.w3.org/2000/svg" class="ico ico-${n} ${t.className}" viewBox="0 0 24 24" fill="none">${t.hasAttribute("x")?"":e}</svg>`,o.observe(t.childNodes[0]),s&&(s=atob(s))&&(t.childNodes[0].onclick=t=>0==s.indexOf("http")?window.open(s):location.href=s)};"undefined"==typeof customElements?document.querySelectorAll("i-con").forEach(s):customElements.define("i-con",class extends HTMLElement{connectedCallback(){s(this)}})})(),(t=>{document.head.innerHTML+="\n<style>\n:root{\n    --trans:opacity 2s ease, left 2s, top 2s;\n}\nslide-show {\ndisplay:block;width:100%;height:300px;overflow:hidden;\nposition:relative;text-align:center;padding:0;margin:0;\nopacity:0;transition:opacity 1s;\n}\nslide-show img {\nheight:100%;width:100%;max-width:100%;\nobject-fit:contain;display:inline-block;\nopacity:0;border:0;margin:auto; transition:var(--trans);\nposition:absolute; top:0; left:0; width:100%; height:100%;\n}\nslide-show.horiz img {left:100%;}\nslide-show.horiz img.bye {left:-100%;}\nslide-show.vert img {top:100%;}\nslide-show.vert img.bye {top:-100%;}\nslide-show img.on {opacity:1; transition:var(--trans);}\nslide-show img.of {opacity:0; transition:var(--trans);}\nslide-show.s1 img:nth-of-type(1){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s2 img:nth-of-type(2){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s3 img:nth-of-type(3){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s4 img:nth-of-type(4){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s5 img:nth-of-type(5){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s6 img:nth-of-type(6){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s7 img:nth-of-type(7){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s8 img:nth-of-type(8){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s9 img:nth-of-type(9){left:0;top:0;opacity:1;transition:var(--trans);}\nslide-show.s10 img:nth-of-type(10){left:0;top:0;opacity:1;transition:var(--trans);}\n</style>";const e=t=>new Promise((e,n)=>setTimeout(e,t)),n=t=>{t.classList.add("s"+(t.cur+1))},o=t=>{const i=parseInt(t.getAttribute("speed"))||3,r=(t.getAttribute("mode"),t.querySelectorAll("img")),a=async o=>{(t=>{const e=t.querySelectorAll("img");t.classList.remove("s"+(t.cur+1)),e.forEach((e,n)=>n==t.cur?e.classList.add("bye"):e.classList.remove("bye"))})(t),t.cur=(t.cur+1)%r.length;let s=r[t.cur],i=t.classList.contains("horiz")||t.classList.contains("vert")?1:500;s.src?await e(i):(s.src=s.dataset.src,delete s.dataset.src,await Promise.all([new Promise((t,e)=>s.onload=t),e(i)]),delete s.onload),n(t)};t.timer||(t.cur=0,t.style.opacity=1,[1,2,3,4,5,6,7,8,9,10].map(e=>t.classList.remove("s"+e)),r.forEach((t,e)=>{t.classList.remove("bye")}),n(t),console.log("slideshow created")),window._SSlisten||(window.addEventListener("blur",e=>s(t)),window.addEventListener("focus",e=>o(t)),window._SSlisten=1,console.log("blur/focus configured")),t.timer=setInterval(a,1e3*i),console.log("slideshow started")},s=t=>{clearInterval(t.timer),console.log("slideshow paused")};"undefined"==typeof customElements?document.querySelectorAll("slide-show").forEach(o):customElements.define("slide-show",class extends HTMLElement{connectedCallback(){o(this)}disconnectedCallback(){s(this)}})})(),Function.$cms=function(){let{cid:t,root:e,navTree:n,msTransition:o,hasusers:s,uid:i,zones:r,site:a,clientCrumb:c}=_CMS;o=parseInt(o);const l=history,h=window,u=document,d=u.body,m=d.classList,p=t=>t.parentNode;h.onerror=alert;const f=(t,e,n)=>t.addEventListener(e,n),g=t=>u.querySelector(t),y=(t,e)=>t.querySelectorAll(e),w=g("#cms-drawer input"),v=g("#cms-hero");h.setCookie=(t,e)=>document.cookie=`${t}=${e}`,h.cmsScan=t=>(t.preventDefault(),fetch("/cms-scan?"+Math.random()).then(t=>{if(200==t.status)return t.json();throw"Network error "+t.status}).then(t=>{alert(JSON.stringify(t,null,3))}).catch(t=>alert("Scan failed: "+t)),!0),h.cmsSync=t=>(t.preventDefault(),fetch("/cms-sync?"+Math.random()).then(t=>{if(200==t.status)return t.json();throw"Network error "+t.status}).then(t=>{alert(JSON.stringify(t,null,3))}).catch(t=>alert("Sync failed: "+t)),!0),h.authNull=t=>(t.preventDefault(),document.cookie="",fetch("/zauth-logout?"+Math.random(),{method:"GET",headers:{Authorization:"Basic 000000"}}).then(t=>{if(401==t.status||200==t.status)return t.json();throw"Network error "+t.status}).then(t=>{location.href="/"}).catch(t=>alert("Logout failed: "+t)),!0),h.authTry=t=>{t.preventDefault(),fetch("/zauth-login?"+Math.random()).then(t=>{if(200==t.status)return t.json();throw"Network error "+t.status}).then(t=>{location.reload()}).catch(t=>alert("Login failed"))};const b=(t,o)=>{t=t||location.pathname,y(u,"[cms]").forEach(t=>t.src=t.getAttribute("content")||t.innerHTML);let c=g("#cms-nav"),l=Function.$cmsRenderTree(n,e,t,w&&w.value,[`<a cms href="/">${a}</a>`]);o&&(g("#cms-crumb").innerHTML=l.crumb.length>0?l.crumb.slice(0,-1).map((t,e)=>`<span class="cr${l.crumb.length-(e+2)}"><i>${t}</i>&nbsp;&raquo;</span>`).join(" "):""),c.innerHTML=l.tree,i?(r&&r.indexOf("cms")&&(c.innerHTML+='<ul class="logb"><li><a href="" onclick="cmsScan(event)">Scan content</a></li></ul>',c.innerHTML+='<ul class="logb"><li><a href="" onclick="cmsSync(event)">Sync content</a></li></ul>'),c.innerHTML+=`<ul class="logb"><li><a href="" onclick="authNull(event)">Logout <b>${i}</b></a></li></ul>`):s&&(c.innerHTML+='<ul class="logb"><li><a href="" onclick="authTry(event)">Login</a></li></ul>'),y(u,"a[cms]").forEach(t=>{t.onclick=$,t.removeAttribute("cms")}),S=Array.from(y(u,"div#cms-nav ul li>ul")).map(p),S.forEach(t=>t.onclick=t.onclick||T),k()},L=function(t,e){m.remove("cms-menu"),_CMS.cid=t._cid;let n,s=[],i=[],r={};t[404]&&(t={h1:"404 not found",title:"404 not found",content:"The requested page does not exist."}),y(u,"[cms]").forEach(t=>{let e=t.id.slice(4);t.hasAttribute("content")?(r[e]=t.getAttribute("content"),t.setAttribute("content","")):(r[e]=t.src||t.innerHTML,t.innerHTML="")});let a=[];return t.$keys().forEach(e=>{(n=g(`#cms-${e}`))?(n.hasAttribute("content")?n.setAttribute("content",t[e].$htmlEscape()):(n.innerHTML=t[e].trim(),d.contains(n)&&a.push(n)),s.push(e)):i.push(e)}),o>0&&(m.remove("cms-updated"),m.add("cms-updating")),b(e,!t.crumb),v.style.display=v.innerHTML.length?"block":"none",g("#cms-body").scrollTo(0,0),setTimeout(()=>{m.add("cms-updated"),m.remove("cms-updating"),setTimeout(()=>{m.remove("cms-updated")},o)},o),r},$=function(){if(h._QUIT)return alert("Nav disabled while edit in progress"),!1;let t=this.getAttribute("href"),n=t.split(".htm").join(".json");return n==`${e}/`&&(n=`${e}/index.cms.json`),m.remove("cms-menu"),m.add("cms-fetching"),setTimeout(()=>{return(e=n,Promise.race([e.$getJSON(),new Promise((t,e)=>setTimeout(t=>e(new Error("Server timeout, check connection.")),5e3))])).then(e=>{m.remove("cms-fetching");let n=L(e,t);l.replaceState({J:n},n.title,location.pathname),l.pushState({J:e},e.title,t)}).catch(t=>{m.remove("cms-fetching"),alert(t)});var e},1),!1};let S;const T=t=>{t.target.debounce||(t.target.classList.toggle("open"),t.target.classList.contains("open"),t.target.debounce=1,setTimeout(e=>delete t.target.debounce,10),S.forEach(e=>{e===t.target||e.contains(t.target)||e.classList.remove("open")}))};f(g("#cms-body"),"click",t=>m.remove("cms-menu")),f(h,"popstate",t=>t.state&&t.state.J?L(t.state.J,location.pathname):location.reload());const k=(t,e)=>{e&&e.preventDefault();let n,o=y(u,"#cms-nav a"),s=-1;if(o.forEach((t,e)=>{p(t).classList.contains("cur")&&(n=t,s=e)}),0==t)return n&&n.click();t<0&&s>0&&s--,t>0&&s<o.length-1&&s++,o.forEach((t,e)=>{e==s?(n=t,p(t).classList.add("cur")):p(t).classList.remove("cur")}),n&&(y(u,"#cms-nav li").forEach(t=>{t.contains(n)?t.classList.add("open"):t.classList.remove("open")}),n.scrollIntoView&&setTimeout(t=>{return o=n.getBoundingClientRect(),s=Math.max(u.documentElement.clientHeight,h.innerHeight),!(e?!(o.bottom<0||o.top>=s):!(o.top<0||o.bottom>=s))&&n.scrollIntoView();var e,o,s},400))};f(h,"keydown",t=>{if("Escape"==t.key&&!h._QUIT&&d.clientWidth<1e3)return m.toggle("cms-menu");m.contains("cms-menu")&&("ArrowUp"==t.key&&k(-1,t),"ArrowDown"==t.key&&k(1,t),"Space"!=t.code&&"Enter"!=t.key||k(0,t))}),f(h,"swiped-right",t=>m.add("cms-menu")),f(h,"swiped-left",t=>m.remove("cms-menu")),f(h,"resize",t=>m.remove("cms-menu")),h.webShare=t=>{if(navigator.share){const{title:e,text:n,host:o,path:s}=t||{};t={title:e||g("#cms-h1").innerText||document.title,text:n||g("#cms-description").getAttribute("content")||g("#cms-content").innerText.slice(0,140)||"No description",url:`https://${o||location.host}${s||location.pathname}`},navigator.share(t).then(t=>console.log("Share OK")).catch(console.log)}else alert("Web share unavailable on this device")},w&&f(w,"keyup",b),b(null,!g("#cms-crumb").innerHTML)},Object.prototype,Object.prototype.$keys=function(){return Object.keys(this)},String.prototype,String.prototype.$getJSON=function(t){let e=this.toString();return new Promise((n,o)=>{let s="undefined"==typeof fetch?require("node-fetch"):fetch,i={headers:{Accept:"application/json"}};t&&t.username&&t.password&&(i.headers.Authorization="Basic "+(t.username+":"+t.password).$btoa()),t&&t.post&&t.post.constructor===Object&&(i.headers["Content-Type"]="application/json",i.method="post",i.body=JSON.stringify(t.post)),s(e,i).then(t=>t.json()).then(t=>n(t)).catch(o)})},String.htmlEscape,String.prototype.$htmlEscape=function(t){return t?this.toString().replace(/"/g,"&quot;"):this.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},Function.$cmsRenderTree=function t(e,n,o,s,i){let r,a,c,l,h,u,d,m,p,f;return(s=(s||"").trim().toLowerCase()).length<2&&(s=""),i=i||[],{tree:`<ul class="nav">${`${e.map(e=>{if(r="index.cms.htm"==e.u?`${n}/`:`${n}/${e.tru||e.dir||e.u}`,l=o==r||"/"==o&&"/index.cms.htm"==r,h=s&&r.toLowerCase().indexOf(s)<0,e&&e.u){if(p=!1,d=e.l||e.u.replace(".cms.htm","").split("-").join(" "),h&&d.toLowerCase().indexOf(s)<0)return;u=`<a cms href="${r}">${d}</a>`,l&&i.push(d)}else{if(m=t(e.nodes,r,o,s,[]),h&&!m.hashit)return;p=m.open,m.open&&(i.push(`<a cms href="${n}/${e.tru||e.dir}.cms.htm">${e.dir||e.tru}</a>`),i=i.concat(m.crumb)),u=`${e.dir.split("-").join(" ")}\n${m.tree}`}return a=a||l||p||s,c=!!s,f=[],e.dir&&f.push("sub"),l&&f.push("sel cur"),p&&f.push("open"),e.priv&&f.push("priv"),`<li class="${f.join(" ")}">${u}</li>`}).join("")}`}</ul>`,open:a,hashit:c,crumb:i}},Function.$fetch=fetch,String.prototype,String.prototype.$btoa=function(){return btoa(this.toString())},Function.$cms();